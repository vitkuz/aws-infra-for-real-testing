"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_logger_1 = require("@vitkuz/aws-logger");
exports.handler = (0, aws_logger_1.withLogger)(async (event, context) => {
    const logger = (0, aws_logger_1.getLogger)();
    if (!logger)
        throw new Error('Logger context missing');
    logger.info('SNS Handler Invoked', { data: { eventType: 'SNS Trigger', recordCount: event.Records.length } });
    for (const record of event.Records) {
        const snsMessage = record.Sns;
        const requestId = snsMessage.MessageAttributes?.[aws_logger_1.REQUEST_ID_KEY]?.Value;
        const recordLogger = logger.child(requestId ? { [aws_logger_1.REQUEST_ID_KEY]: requestId } : {});
        recordLogger.info('Processing SNS Message', {
            data: {
                messageId: snsMessage.MessageId,
                subject: snsMessage.Subject,
                message: snsMessage.Message,
                timestamp: snsMessage.Timestamp
            }
        });
    }
    return { statusCode: 200, body: `Processed ${event.Records.length} records` };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxtREFBMkU7QUFFOUQsUUFBQSxPQUFPLEdBQUcsSUFBQSx1QkFBVSxFQUFDLEtBQUssRUFBRSxLQUFlLEVBQUUsT0FBZ0IsRUFBRSxFQUFFO0lBQzFFLE1BQU0sTUFBTSxHQUFHLElBQUEsc0JBQVMsR0FBRSxDQUFDO0lBQzNCLElBQUksQ0FBQyxNQUFNO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBRXZELE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUU5RyxLQUFLLE1BQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQzlCLE1BQU0sU0FBUyxHQUFHLFVBQVUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLDJCQUFjLENBQUMsRUFBRSxLQUFLLENBQUM7UUFDeEUsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQywyQkFBYyxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXBGLFlBQVksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDeEMsSUFBSSxFQUFFO2dCQUNGLFNBQVMsRUFBRSxVQUFVLENBQUMsU0FBUztnQkFDL0IsT0FBTyxFQUFFLFVBQVUsQ0FBQyxPQUFPO2dCQUMzQixPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU87Z0JBQzNCLFNBQVMsRUFBRSxVQUFVLENBQUMsU0FBUzthQUNsQztTQUNKLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sVUFBVSxFQUFFLENBQUM7QUFDbEYsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb250ZXh0LCBTTlNFdmVudCB9IGZyb20gJ2F3cy1sYW1iZGEnO1xuaW1wb3J0IHsgd2l0aExvZ2dlciwgZ2V0TG9nZ2VyLCBSRVFVRVNUX0lEX0tFWSB9IGZyb20gJ0B2aXRrdXovYXdzLWxvZ2dlcic7XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gd2l0aExvZ2dlcihhc3luYyAoZXZlbnQ6IFNOU0V2ZW50LCBjb250ZXh0OiBDb250ZXh0KSA9PiB7XG4gICAgY29uc3QgbG9nZ2VyID0gZ2V0TG9nZ2VyKCk7XG4gICAgaWYgKCFsb2dnZXIpIHRocm93IG5ldyBFcnJvcignTG9nZ2VyIGNvbnRleHQgbWlzc2luZycpO1xuXG4gICAgbG9nZ2VyLmluZm8oJ1NOUyBIYW5kbGVyIEludm9rZWQnLCB7IGRhdGE6IHsgZXZlbnRUeXBlOiAnU05TIFRyaWdnZXInLCByZWNvcmRDb3VudDogZXZlbnQuUmVjb3Jkcy5sZW5ndGggfSB9KTtcblxuICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIGV2ZW50LlJlY29yZHMpIHtcbiAgICAgICAgY29uc3Qgc25zTWVzc2FnZSA9IHJlY29yZC5TbnM7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RJZCA9IHNuc01lc3NhZ2UuTWVzc2FnZUF0dHJpYnV0ZXM/LltSRVFVRVNUX0lEX0tFWV0/LlZhbHVlO1xuICAgICAgICBjb25zdCByZWNvcmRMb2dnZXIgPSBsb2dnZXIuY2hpbGQocmVxdWVzdElkID8geyBbUkVRVUVTVF9JRF9LRVldOiByZXF1ZXN0SWQgfSA6IHt9KTtcblxuICAgICAgICByZWNvcmRMb2dnZXIuaW5mbygnUHJvY2Vzc2luZyBTTlMgTWVzc2FnZScsIHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlSWQ6IHNuc01lc3NhZ2UuTWVzc2FnZUlkLFxuICAgICAgICAgICAgICAgIHN1YmplY3Q6IHNuc01lc3NhZ2UuU3ViamVjdCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBzbnNNZXNzYWdlLk1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wOiBzbnNNZXNzYWdlLlRpbWVzdGFtcFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IGBQcm9jZXNzZWQgJHtldmVudC5SZWNvcmRzLmxlbmd0aH0gcmVjb3Jkc2AgfTtcbn0pO1xuIl19