"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_logger_1 = require("@vitkuz/aws-logger");
exports.handler = (0, aws_logger_1.withLogger)(async (event, context) => {
    const logger = (0, aws_logger_1.getLogger)();
    if (!logger)
        throw new Error('Logger context missing');
    logger.info('SNS Handler Invoked', { eventType: 'SNS Trigger', recordCount: event.Records.length });
    for (const record of event.Records) {
        const snsMessage = record.Sns;
        const requestId = snsMessage.MessageAttributes?.[aws_logger_1.REQUEST_ID_KEY]?.Value;
        const recordLogger = logger.child(requestId ? { [aws_logger_1.REQUEST_ID_KEY]: requestId } : {});
        recordLogger.info('Processing SNS Message', {
            messageId: snsMessage.MessageId,
            subject: snsMessage.Subject,
            message: snsMessage.Message,
            timestamp: snsMessage.Timestamp
        });
    }
    return { statusCode: 200, body: `Processed ${event.Records.length} records` };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLG1EQUEyRTtBQUU5RCxRQUFBLE9BQU8sR0FBRyxJQUFBLHVCQUFVLEVBQUMsS0FBSyxFQUFFLEtBQWUsRUFBRSxPQUFnQixFQUFFLEVBQUU7SUFDMUUsTUFBTSxNQUFNLEdBQUcsSUFBQSxzQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBSSxDQUFDLE1BQU07UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFFdkQsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUVwRyxLQUFLLE1BQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQzlCLE1BQU0sU0FBUyxHQUFHLFVBQVUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLDJCQUFjLENBQUMsRUFBRSxLQUFLLENBQUM7UUFDeEUsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQywyQkFBYyxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXBGLFlBQVksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7WUFDeEMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxTQUFTO1lBQy9CLE9BQU8sRUFBRSxVQUFVLENBQUMsT0FBTztZQUMzQixPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU87WUFDM0IsU0FBUyxFQUFFLFVBQVUsQ0FBQyxTQUFTO1NBQ2xDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sVUFBVSxFQUFFLENBQUM7QUFDbEYsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb250ZXh0LCBTTlNFdmVudCB9IGZyb20gJ2F3cy1sYW1iZGEnO1xuaW1wb3J0IHsgd2l0aExvZ2dlciwgZ2V0TG9nZ2VyLCBSRVFVRVNUX0lEX0tFWSB9IGZyb20gJ0B2aXRrdXovYXdzLWxvZ2dlcic7XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gd2l0aExvZ2dlcihhc3luYyAoZXZlbnQ6IFNOU0V2ZW50LCBjb250ZXh0OiBDb250ZXh0KSA9PiB7XG4gICAgY29uc3QgbG9nZ2VyID0gZ2V0TG9nZ2VyKCk7XG4gICAgaWYgKCFsb2dnZXIpIHRocm93IG5ldyBFcnJvcignTG9nZ2VyIGNvbnRleHQgbWlzc2luZycpO1xuXG4gICAgbG9nZ2VyLmluZm8oJ1NOUyBIYW5kbGVyIEludm9rZWQnLCB7IGV2ZW50VHlwZTogJ1NOUyBUcmlnZ2VyJywgcmVjb3JkQ291bnQ6IGV2ZW50LlJlY29yZHMubGVuZ3RoIH0pO1xuXG4gICAgZm9yIChjb25zdCByZWNvcmQgb2YgZXZlbnQuUmVjb3Jkcykge1xuICAgICAgICBjb25zdCBzbnNNZXNzYWdlID0gcmVjb3JkLlNucztcbiAgICAgICAgY29uc3QgcmVxdWVzdElkID0gc25zTWVzc2FnZS5NZXNzYWdlQXR0cmlidXRlcz8uW1JFUVVFU1RfSURfS0VZXT8uVmFsdWU7XG4gICAgICAgIGNvbnN0IHJlY29yZExvZ2dlciA9IGxvZ2dlci5jaGlsZChyZXF1ZXN0SWQgPyB7IFtSRVFVRVNUX0lEX0tFWV06IHJlcXVlc3RJZCB9IDoge30pO1xuXG4gICAgICAgIHJlY29yZExvZ2dlci5pbmZvKCdQcm9jZXNzaW5nIFNOUyBNZXNzYWdlJywge1xuICAgICAgICAgICAgbWVzc2FnZUlkOiBzbnNNZXNzYWdlLk1lc3NhZ2VJZCxcbiAgICAgICAgICAgIHN1YmplY3Q6IHNuc01lc3NhZ2UuU3ViamVjdCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHNuc01lc3NhZ2UuTWVzc2FnZSxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogc25zTWVzc2FnZS5UaW1lc3RhbXBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogMjAwLCBib2R5OiBgUHJvY2Vzc2VkICR7ZXZlbnQuUmVjb3Jkcy5sZW5ndGh9IHJlY29yZHNgIH07XG59KTtcbiJdfQ==