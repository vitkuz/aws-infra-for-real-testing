"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_logger_1 = require("@vitkuz/aws-logger");
exports.handler = (0, aws_logger_1.withLogger)(async (event, context) => {
    const logger = (0, aws_logger_1.getLogger)();
    if (!logger)
        throw new Error('Logger context missing');
    logger.info('SQS Handler Invoked', { data: { eventType: 'SQS Trigger' } });
    // Only process Records (Consumer Logic)
    if (event.Records) {
        for (const record of event.Records) {
            const requestId = record.messageAttributes?.[aws_logger_1.REQUEST_ID_KEY]?.stringValue;
            const recordLogger = logger.child(requestId ? { [aws_logger_1.REQUEST_ID_KEY]: requestId } : {});
            recordLogger.info('Processing SQS Record', { data: { messageId: record.messageId, body: record.body } });
        }
        return { statusCode: 200, body: `Processed ${event.Records.length} records` };
    }
    logger.warn('Invoked without Records', { data: { event } });
    return { statusCode: 200, body: 'No records processed' };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxtREFBMkU7QUFFOUQsUUFBQSxPQUFPLEdBQUcsSUFBQSx1QkFBVSxFQUFDLEtBQUssRUFBRSxLQUFlLEVBQUUsT0FBZ0IsRUFBRSxFQUFFO0lBQzFFLE1BQU0sTUFBTSxHQUFHLElBQUEsc0JBQVMsR0FBRSxDQUFDO0lBQzNCLElBQUksQ0FBQyxNQUFNO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBRXZELE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRTNFLHdDQUF3QztJQUN4QyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNoQixLQUFLLE1BQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNqQyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQywyQkFBYyxDQUFDLEVBQUUsV0FBVyxDQUFDO1lBQzFFLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsMkJBQWMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVwRixZQUFZLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDN0csQ0FBQztRQUNELE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxhQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxVQUFVLEVBQUUsQ0FBQztJQUNsRixDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1RCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsc0JBQXNCLEVBQUUsQ0FBQztBQUM3RCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRleHQsIFNRU0V2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyB3aXRoTG9nZ2VyLCBnZXRMb2dnZXIsIFJFUVVFU1RfSURfS0VZIH0gZnJvbSAnQHZpdGt1ei9hd3MtbG9nZ2VyJztcblxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSB3aXRoTG9nZ2VyKGFzeW5jIChldmVudDogU1FTRXZlbnQsIGNvbnRleHQ6IENvbnRleHQpID0+IHtcbiAgICBjb25zdCBsb2dnZXIgPSBnZXRMb2dnZXIoKTtcbiAgICBpZiAoIWxvZ2dlcikgdGhyb3cgbmV3IEVycm9yKCdMb2dnZXIgY29udGV4dCBtaXNzaW5nJyk7XG5cbiAgICBsb2dnZXIuaW5mbygnU1FTIEhhbmRsZXIgSW52b2tlZCcsIHsgZGF0YTogeyBldmVudFR5cGU6ICdTUVMgVHJpZ2dlcicgfSB9KTtcblxuICAgIC8vIE9ubHkgcHJvY2VzcyBSZWNvcmRzIChDb25zdW1lciBMb2dpYylcbiAgICBpZiAoZXZlbnQuUmVjb3Jkcykge1xuICAgICAgICBmb3IgKGNvbnN0IHJlY29yZCBvZiBldmVudC5SZWNvcmRzKSB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0SWQgPSByZWNvcmQubWVzc2FnZUF0dHJpYnV0ZXM/LltSRVFVRVNUX0lEX0tFWV0/LnN0cmluZ1ZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcmVjb3JkTG9nZ2VyID0gbG9nZ2VyLmNoaWxkKHJlcXVlc3RJZCA/IHsgW1JFUVVFU1RfSURfS0VZXTogcmVxdWVzdElkIH0gOiB7fSk7XG5cbiAgICAgICAgICAgIHJlY29yZExvZ2dlci5pbmZvKCdQcm9jZXNzaW5nIFNRUyBSZWNvcmQnLCB7IGRhdGE6IHsgbWVzc2FnZUlkOiByZWNvcmQubWVzc2FnZUlkLCBib2R5OiByZWNvcmQuYm9keSB9IH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogYFByb2Nlc3NlZCAke2V2ZW50LlJlY29yZHMubGVuZ3RofSByZWNvcmRzYCB9O1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKCdJbnZva2VkIHdpdGhvdXQgUmVjb3JkcycsIHsgZGF0YTogeyBldmVudCB9IH0pO1xuICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogJ05vIHJlY29yZHMgcHJvY2Vzc2VkJyB9O1xufSk7XG4iXX0=