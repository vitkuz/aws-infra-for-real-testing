"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const aws_logger_1 = require("@vitkuz/aws-logger");
exports.handler = (0, aws_logger_1.withLogger)(async (event, context) => {
    const logger = (0, aws_logger_1.getLogger)();
    if (!logger)
        throw new Error('Logger context missing');
    logger.info('SQS Handler Invoked', { eventType: 'SQS Trigger' });
    // Only process Records (Consumer Logic)
    if (event.Records) {
        for (const record of event.Records) {
            const requestId = record.messageAttributes?.[aws_logger_1.REQUEST_ID_KEY]?.stringValue;
            const recordLogger = logger.child(requestId ? { [aws_logger_1.REQUEST_ID_KEY]: requestId } : {});
            recordLogger.info('Processing SQS Record', { messageId: record.messageId, body: record.body });
        }
        return { statusCode: 200, body: `Processed ${event.Records.length} records` };
    }
    logger.warn('Invoked without Records', { event });
    return { statusCode: 200, body: 'No records processed' };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3FzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLG1EQUEyRTtBQUU5RCxRQUFBLE9BQU8sR0FBRyxJQUFBLHVCQUFVLEVBQUMsS0FBSyxFQUFFLEtBQWUsRUFBRSxPQUFnQixFQUFFLEVBQUU7SUFDMUUsTUFBTSxNQUFNLEdBQUcsSUFBQSxzQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBSSxDQUFDLE1BQU07UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFFdkQsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO0lBRWpFLHdDQUF3QztJQUN4QyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNoQixLQUFLLE1BQU0sTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNqQyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQywyQkFBYyxDQUFDLEVBQUUsV0FBVyxDQUFDO1lBQzFFLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsMkJBQWMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVwRixZQUFZLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ25HLENBQUM7UUFDRCxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sVUFBVSxFQUFFLENBQUM7SUFDbEYsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxDQUFDO0FBQzdELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29udGV4dCwgU1FTRXZlbnQgfSBmcm9tICdhd3MtbGFtYmRhJztcbmltcG9ydCB7IHdpdGhMb2dnZXIsIGdldExvZ2dlciwgUkVRVUVTVF9JRF9LRVkgfSBmcm9tICdAdml0a3V6L2F3cy1sb2dnZXInO1xuXG5leHBvcnQgY29uc3QgaGFuZGxlciA9IHdpdGhMb2dnZXIoYXN5bmMgKGV2ZW50OiBTUVNFdmVudCwgY29udGV4dDogQ29udGV4dCkgPT4ge1xuICAgIGNvbnN0IGxvZ2dlciA9IGdldExvZ2dlcigpO1xuICAgIGlmICghbG9nZ2VyKSB0aHJvdyBuZXcgRXJyb3IoJ0xvZ2dlciBjb250ZXh0IG1pc3NpbmcnKTtcblxuICAgIGxvZ2dlci5pbmZvKCdTUVMgSGFuZGxlciBJbnZva2VkJywgeyBldmVudFR5cGU6ICdTUVMgVHJpZ2dlcicgfSk7XG5cbiAgICAvLyBPbmx5IHByb2Nlc3MgUmVjb3JkcyAoQ29uc3VtZXIgTG9naWMpXG4gICAgaWYgKGV2ZW50LlJlY29yZHMpIHtcbiAgICAgICAgZm9yIChjb25zdCByZWNvcmQgb2YgZXZlbnQuUmVjb3Jkcykge1xuICAgICAgICAgICAgY29uc3QgcmVxdWVzdElkID0gcmVjb3JkLm1lc3NhZ2VBdHRyaWJ1dGVzPy5bUkVRVUVTVF9JRF9LRVldPy5zdHJpbmdWYWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZExvZ2dlciA9IGxvZ2dlci5jaGlsZChyZXF1ZXN0SWQgPyB7IFtSRVFVRVNUX0lEX0tFWV06IHJlcXVlc3RJZCB9IDoge30pO1xuXG4gICAgICAgICAgICByZWNvcmRMb2dnZXIuaW5mbygnUHJvY2Vzc2luZyBTUVMgUmVjb3JkJywgeyBtZXNzYWdlSWQ6IHJlY29yZC5tZXNzYWdlSWQsIGJvZHk6IHJlY29yZC5ib2R5IH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHN0YXR1c0NvZGU6IDIwMCwgYm9keTogYFByb2Nlc3NlZCAke2V2ZW50LlJlY29yZHMubGVuZ3RofSByZWNvcmRzYCB9O1xuICAgIH1cblxuICAgIGxvZ2dlci53YXJuKCdJbnZva2VkIHdpdGhvdXQgUmVjb3JkcycsIHsgZXZlbnQgfSk7XG4gICAgcmV0dXJuIHsgc3RhdHVzQ29kZTogMjAwLCBib2R5OiAnTm8gcmVjb3JkcyBwcm9jZXNzZWQnIH07XG59KTtcbiJdfQ==